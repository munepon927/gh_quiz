<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Grasshopper åŸºç¤ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ã‚¯ã‚¤ã‚ºï¼ˆç”»åƒï¼‹æˆç¸¾è¨˜éŒ²ï¼‰</title>
<style>
  :root {
    --bg: #0b1020;
    --card: #12182b;
    --ink: #e9eef9;
    --muted: #a9b3c9;
    --accent: #4aa8ff;
    --accent-2: #82e0aa;
    --wrong: #ff6b6b;
  }
  * { box-sizing: border-box; }
  body {
    margin: 0; background: var(--bg); color: var(--ink);
    font-family: "Inter", "Segoe UI", system-ui, -apple-system, Roboto, "Helvetica Neue", Arial, "Noto Sans JP", sans-serif;
  }
  header {
    padding: 20px 16px; border-bottom: 1px solid #223; position: sticky; top: 0; background: rgba(11,16,32,.85); backdrop-filter: blur(6px);
  }
  header h1 { margin: 0 0 6px; font-size: 20px; font-weight: 700; }
  header .sub { color: var(--muted); font-size: 12px; }

  .wrap {
    max-width: 1024px; margin: 0 auto; padding: 24px 16px; display: grid; grid-template-columns: 1fr 320px; gap: 16px;
  }
  @media (max-width: 900px){ .wrap { grid-template-columns: 1fr; } }

  .card {
    background: var(--card); border: 1px solid #1b2238; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.25);
  }
  .quiz {
    padding: 20px;
  }
  .q-head { display:flex; align-items:center; gap: 10px; margin-bottom: 12px; }
  .pill {
    font-size: 12px; color: var(--ink); background: #1a2240; border: 1px solid #2a3560; padding: 4px 10px; border-radius: 999px;
  }
  .q-title { font-size: 20px; margin: 0; }
  .q-img {
    width: 280px; max-width: 90%; border-radius: 12px; border: 1px solid #243054; background: #0f1530; padding: 8px; margin: 12px auto 18px; display: block;
  }
  .choices { display: grid; gap: 10px; margin-top: 10px; }
  .choice {
    text-align: left; background: #0f1530; border: 1px solid #223159; color: var(--ink);
    border-radius: 12px; padding: 14px; cursor: pointer; transition: transform .05s ease, border-color .2s ease;
  }
  .choice:hover { transform: translateY(-1px); border-color: #335; }
  .choice.correct { border-color: var(--accent-2); box-shadow: inset 0 0 0 1px var(--accent-2); }
  .choice.wrong { border-color: var(--wrong); box-shadow: inset 0 0 0 1px var(--wrong); }
  .explain { margin-top: 12px; color: var(--muted); font-size: 14px; line-height: 1.6; }
  .controls { display:flex; gap:10px; margin-top: 16px; }
  .btn {
    background: var(--accent); color:#00122b; border: none; border-radius: 10px; padding: 10px 14px; font-weight: 700; cursor: pointer;
  }
  .btn.secondary { background: #1a2240; color: var(--ink); border:1px solid #2a3560; }
  .btn:disabled { opacity:.5; cursor:not-allowed; }

  .score {
    padding: 16px;
  }
  .score h3 { margin: 0 0 8px; font-size: 16px; }
  .kpi {
    display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;
  }
  .kpi .box {
    background:#0f1530; border:1px solid #1e2b4d; padding: 12px; border-radius: 12px;
  }
  .kpi .big { font-size: 28px; font-weight: 800; }
  .bar {
    width: 100%; height: 8px; border-radius: 999px; background: #101831; overflow: hidden; border:1px solid #1f2a4b;
  }
  .bar > div {
    height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent) 0%, var(--accent-2) 100%);
    transition: width .5s ease;
  }
  table {
    width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 13px;
  }
  th, td { padding: 8px; border-bottom: 1px solid #1d2744; text-align: left; }
  th { color: var(--muted); font-weight: 600; }
  .mini-pill { font-size: 11px; color: #0b1020; background: var(--accent-2); padding: 2px 8px; border-radius: 999px; }

  .footer-note { color: var(--muted); font-size: 12px; padding: 10px 16px 20px; text-align: center; }
</style>
</head>
<body>
<header>
  <h1>ğŸ§© Grasshopper åŸºç¤ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ã‚¯ã‚¤ã‚º</h1>
  <div class="sub">ç”»åƒä»˜ããƒ»æ­£è§£ç‡è¨˜éŒ²ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ï¼‰ãƒ»é¸æŠè‚¢ãƒ©ãƒ³ãƒ€ãƒ </div>
</header>

<div class="wrap">
  <!-- Quiz Column -->
  <section id="quizCard" class="card quiz" aria-live="polite">
    <div class="q-head">
      <span class="pill" id="progressPill">Q 1 / 10</span>
      <span class="pill" id="topicPill">â€”</span>
    </div>
    <h2 id="qTitle" class="q-title">èª­ã¿è¾¼ã¿ä¸­â€¦</h2>
    <img id="qImg" class="q-img" alt="Component image" src="" onerror="this.style.display='none';" />
    <div id="choices" class="choices"></div>
    <div id="explain" class="explain"></div>
    <div class="controls">
      <button id="nextBtn" class="btn" disabled>æ¬¡ã®å•é¡Œã¸</button>
      <button id="skipBtn" class="btn secondary">ã‚¹ã‚­ãƒƒãƒ—</button>
    </div>
  </section>

  <!-- Score/Stats Column -->
  <aside class="card score">
    <h3>ğŸ“Š æˆç¸¾ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h3>
    <div class="kpi">
      <div class="box">
        <div>ä»Šå›ã®æ­£è§£ç‡</div>
        <div id="sessionAcc" class="big">â€”</div>
        <div class="bar"><div id="sessionBar"></div></div>
      </div>
      <div class="box">
        <div>ç´¯ç©ã®æ­£è§£ç‡</div>
        <div id="globalAcc" class="big">â€”</div>
        <div class="bar"><div id="globalBar"></div></div>
      </div>
    </div>
    <table id="perItem">
      <thead><tr><th>ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ</th><th>æ­£è§£ / è©¦è¡Œ</th><th>ç‡</th></tr></thead>
      <tbody></tbody>
    </table>
    <div style="display:flex; gap:8px; margin-top:10px;">
      <button id="resetSession" class="btn secondary" title="ã“ã®ãƒ—ãƒ¬ã‚¤ã®è¨˜éŒ²ã‚’ãƒªã‚»ãƒƒãƒˆ">ä»Šå›ã®è¨˜éŒ²ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
      <button id="resetGlobal" class="btn secondary" title="ç´¯ç©ï¼ˆlocalStorageï¼‰ã®è¨˜éŒ²ã‚’ãƒªã‚»ãƒƒãƒˆ">ç´¯ç©ã®è¨˜éŒ²ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
  </aside>
</div>

<p class="footer-note">ç”»åƒãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯ <code>assets/</code> ã«PNGã‚’é…ç½®ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ <code>questions</code> ã® <code>img</code> ã«åˆã‚ã›ã¦ãã ã•ã„ã€‚</p>

<script>
/** ========= ãƒ‡ãƒ¼ã‚¿å®šç¾© ========= **/
const questions = [
  {
    id: "Rectangle",
    title: "Rectangle ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ©Ÿèƒ½ã¯ï¼Ÿ",
    img: "assets/rectangle.png",
    correct: "é•·æ–¹å½¢ã‚’ä½œæˆï¼ˆå¹³é¢ãƒ»å¹…ãƒ»é«˜ã•ã‹ã‚‰çŸ©å½¢ã‚«ãƒ¼ãƒ–ï¼‰",
    choices: [
      "æ•°å€¤ç¯„å›²ã‹ã‚‰é€£ç¶šãƒªã‚¹ãƒˆã‚’ä½œæˆ",
      "é•·æ–¹å½¢ã‚’ä½œæˆï¼ˆå¹³é¢ãƒ»å¹…ãƒ»é«˜ã•ã‹ã‚‰çŸ©å½¢ã‚«ãƒ¼ãƒ–ï¼‰",
      "æ•°å€¤ã‚’åˆ¥ç¯„å›²ã¸ç·šå½¢å¤‰æ›",
      "ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚’ãƒ™ã‚¯ãƒˆãƒ«åˆ†ã ã‘ç§»å‹•"
    ],
    explain: "Rectangle ã¯åŸºæº–å¹³é¢ãƒ»å¹…ãƒ»é«˜ã•ãªã©ã‚’å…¥åŠ›ã—ã€çŸ©å½¢ã‚«ãƒ¼ãƒ–ï¼ˆå ´åˆã«ã‚ˆã£ã¦ã¯é¢ç”Ÿæˆã«åˆ©ç”¨ï¼‰ã‚’ä½œã‚Šã¾ã™ã€‚"
  },
  {
    id: "Range",
    title: "Range ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¸»ç”¨é€”ã¯ï¼Ÿ",
    img: "assets/range.png",
    correct: "æ•°å€¤ç¯„å›²ã‹ã‚‰é€£ç¶šãƒªã‚¹ãƒˆã‚’ä½œæˆ",
    choices: [
      "æ•°å€¤ç¯„å›²ã‹ã‚‰é€£ç¶šãƒªã‚¹ãƒˆã‚’ä½œæˆ",
      "é•·æ–¹å½¢ã®é¢ç©ã‚’è¨ˆç®—",
      "ãƒªã‚¹ãƒˆã‚’æ˜‡é †ã«ã‚½ãƒ¼ãƒˆ",
      "æ›²ç·šã‚’ç­‰åˆ†å‰²ã—ã¦ç‚¹ã‚’å‡ºåŠ›"
    ],
    explain: "Range ã¯é–‹å§‹ãƒ»çµ‚äº†ãƒ»åˆ†å‰²æ•°ã‹ã‚‰ä¸€å®šé–“éš”ã®æ•°å€¤ãƒªã‚¹ãƒˆã‚’å‡ºåŠ›ã—ã¾ã™ï¼ˆæ—¢å®šã¯ 0â†’1 ã®ç¯„å›²ï¼‰ã€‚"
  },
  {
    id: "RemapNumbers",
    title: "Remap Numbers ã®æ©Ÿèƒ½ã¯ï¼Ÿ",
    img: "assets/remap_numbers.png",
    correct: "æ•°å€¤ã‚’åˆ¥ç¯„å›²ã¸ç·šå½¢å¤‰æ›",
    choices: [
      "æ•°å€¤ã‚’åˆ¥ç¯„å›²ã¸ç·šå½¢å¤‰æ›",
      "ã‚¸ã‚ªãƒ¡ãƒˆãƒªã®å‹ã‚’å¤‰æ›",
      "çŸ©å½¢ã‚’å›è»¢",
      "æ›²ç·šé•·ã‚’æ±‚ã‚ã‚‹"
    ],
    explain: "å…¥åŠ›ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆæœ€å°ã€œæœ€å¤§ï¼‰ã‹ã‚‰å‡ºåŠ›ãƒ‰ãƒ¡ã‚¤ãƒ³ã¸æ•°å€¤ã‚’æ¯”ä¾‹å¤‰æ›ã—ã¾ã™ã€‚"
  },
  {
    id: "ConstructDomain",
    title: "Construct Domain ã®ç”¨é€”ã¯ï¼Ÿ",
    img: "assets/construct_domain.png",
    correct: "æœ€å°å€¤ã¨æœ€å¤§å€¤ã‹ã‚‰ãƒ‰ãƒ¡ã‚¤ãƒ³å‹ã‚’ç”Ÿæˆ",
    choices: [
      "æœ€å°å€¤ã¨æœ€å¤§å€¤ã‹ã‚‰ãƒ‰ãƒ¡ã‚¤ãƒ³å‹ã‚’ç”Ÿæˆ",
      "å€¤ã‚’æ­£è¦åŒ–ï¼ˆ0ã€œ1ï¼‰",
      "æ›²ç·šã®æ¥ç·šãƒ™ã‚¯ãƒˆãƒ«ã‚’å–å¾—",
      "ãƒ™ã‚¯ãƒˆãƒ«ã‚’æ­£è¦åŒ–"
    ],
    explain: "Min / Max ã‚’ä¸ãˆ Domainï¼ˆç¯„å›²ï¼‰ã‚’ä½œã‚Šã¾ã™ã€‚Remap ç­‰ã®å…¥åŠ›ã«ä½¿ã„ã¾ã™ã€‚"
  },
  {
    id: "Bounds",
    title: "Bounds ã¯ä½•ã‚’è¿”ã™ï¼Ÿ",
    img: "assets/bounds.png",
    correct: "å…¥åŠ›ãƒªã‚¹ãƒˆã®æœ€å°å€¤ãƒ»æœ€å¤§å€¤ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰",
    choices: [
      "å…¥åŠ›ãƒªã‚¹ãƒˆã®æœ€å°å€¤ãƒ»æœ€å¤§å€¤ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰",
      "æ›²ç·šã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒã‚¤ãƒ³ãƒˆåˆ—",
      "å¹³é¢ã®æ³•ç·šãƒ™ã‚¯ãƒˆãƒ«",
      "æ•°å€¤ã®ä¸­å¤®å€¤"
    ],
    explain: "æ•°å€¤ãƒªã‚¹ãƒˆã® min/max ã‚’æ¸¬ã‚Šã€ãã®ç¯„å›²ã‚’ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã—ã¦è¿”ã—ã¾ã™ã€‚"
  },
  {
    id: "DivideCurve",
    title: "Divide Curve ã®æ©Ÿèƒ½ã¯ï¼Ÿ",
    img: "assets/divide_curve.png",
    correct: "æ›²ç·šã‚’ç­‰åˆ†å‰²ã—ã¦åˆ†å‰²ç‚¹ã‚’å‡ºåŠ›",
    choices: [
      "æ›²ç·šã‚’ç­‰åˆ†å‰²ã—ã¦åˆ†å‰²ç‚¹ã‚’å‡ºåŠ›",
      "æ›²ç·šã‚’å›è»¢",
      "é¢ã‚’ç”Ÿæˆ",
      "æ›²ç‡ãƒ—ãƒ­ãƒƒãƒˆã‚’ç”Ÿæˆ"
    ],
    explain: "æŒ‡å®šåˆ†å‰²æ•°ã§æ›²ç·šã‚’å‰²ã‚Šã€å„ä½ç½®ã®ãƒã‚¤ãƒ³ãƒˆï¼ˆå¿…è¦ã«å¿œã˜ã¦æ¥ç·šç­‰ï¼‰ã‚’å¾—ã‚‰ã‚Œã¾ã™ã€‚"
  },
  {
    id: "Area",
    title: "Area ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å‡ºåŠ›ã¯ï¼Ÿ",
    img: "assets/area.png",
    correct: "é¢ç©ã¨é‡å¿ƒï¼ˆCentroidï¼‰",
    choices: [
      "é¢ç©ã¨é‡å¿ƒï¼ˆCentroidï¼‰",
      "æ›²ç·šé•·",
      "çŸ©å½¢ã®å¹…ã¨é«˜ã•",
      "æ³•ç·šãƒ™ã‚¯ãƒˆãƒ«"
    ],
    explain: "å…¥åŠ›ã—ãŸå¹³é¢ã‚«ãƒ¼ãƒ–ã‚„ã‚µãƒ¼ãƒ•ã‚§ã‚¹ã®é¢ç©ã¨é‡å¿ƒç‚¹ã‚’è¿”ã—ã¾ã™ã€‚"
  },
  {
    id: "EvaluateCurve",
    title: "Evaluate Curve ã®å½¹å‰²ã¯ï¼Ÿ",
    img: "assets/evaluate_curve.png",
    correct: "æ›²ç·šä¸Šã®ä»»æ„ä½ç½®ã‚’è©•ä¾¡ï¼ˆç‚¹/æ¥ç·š/æ³•ç·šï¼‰",
    choices: [
      "æ›²ç·šä¸Šã®ä»»æ„ä½ç½®ã‚’è©•ä¾¡ï¼ˆç‚¹/æ¥ç·š/æ³•ç·šï¼‰",
      "æ›²ç·šã‚’é–‰ã˜ã‚‹",
      "æ›²ç·šã‚’åˆ†å‰²",
      "æ›²ç·šã‚’æŠ¼ã—å‡ºã™"
    ],
    explain: "ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆtå€¤ï¼‰ã§æ›²ç·šä¸Šã®ç‚¹ãƒ»æ¥ç·šãƒ™ã‚¯ãƒˆãƒ«ãªã©ã‚’å–å¾—ã§ãã¾ã™ã€‚"
  },
  {
    id: "Move",
    title: "Move ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ©Ÿèƒ½ã¯ï¼Ÿ",
    img: "assets/move.png",
    correct: "ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚’ãƒ™ã‚¯ãƒˆãƒ«åˆ†ã ã‘ç§»å‹•",
    choices: [
      "ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚’ãƒ™ã‚¯ãƒˆãƒ«åˆ†ã ã‘ç§»å‹•",
      "å¹³é¢ã‚’ç”Ÿæˆ",
      "å€¤ã‚’æ˜‡é †ã«ä¸¦ã¹ã‚‹",
      "æ³•ç·šãƒ™ã‚¯ãƒˆãƒ«ã‚’è¨ˆç®—"
    ],
    explain: "å…¥åŠ›ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚’æŒ‡å®šãƒ™ã‚¯ãƒˆãƒ«ã ã‘å¹³è¡Œç§»å‹•ã—ã¾ã™ã€‚"
  },
  {
    id: "Scale",
    title: "Scale ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å½¹å‰²ã¯ï¼Ÿ",
    img: "assets/scale.png",
    correct: "ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚’åŸºç‚¹ã‹ã‚‰æ‹¡ç¸®",
    choices: [
      "ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚’åŸºç‚¹ã‹ã‚‰æ‹¡ç¸®",
      "ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å†æ§‹ç¯‰",
      "é¢ç©ã‚’è¨ˆç®—",
      "ãƒ†ã‚­ã‚¹ãƒˆã‚’å‡ºåŠ›"
    ],
    explain: "æŒ‡å®šã‚¹ã‚±ãƒ¼ãƒ«ä¿‚æ•°ã§ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚’æ‹¡å¤§ãƒ»ç¸®å°ã—ã¾ã™ï¼ˆåŸºç‚¹ã«æ³¨æ„ï¼‰ã€‚"
  }
];

/** ========= ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ========= **/
const shuffle = (arr) => {
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
};

const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
const pctTxt = (n) => (isNaN(n) ? "â€”" : `${(n*100).toFixed(0)}%`);

/** ========= è¨­å®š ========= **/
const QUESTIONS_PER_SESSION = 10; // å‡ºé¡Œæ•°ï¼ˆå¤‰æ›´å¯ï¼‰
const STORAGE_KEY = "gh_quiz_stats_v1";

/** ========= æˆç¸¾è¨˜éŒ²ï¼ˆlocalStorageï¼‰ ========= **/
function loadStats() {
  const raw = localStorage.getItem(STORAGE_KEY);
  if (!raw) return { total: { correct:0, trials:0 }, perItem:{} };
  try { return JSON.parse(raw); } catch { return { total:{correct:0,trials:0}, perItem:{} }; }
}
function saveStats(stats) { localStorage.setItem(STORAGE_KEY, JSON.stringify(stats)); }
function bump(stats, id, isCorrect) {
  // å…¨ä½“
  stats.total.trials += 1;
  if (isCorrect) stats.total.correct += 1;
  // å€‹åˆ¥
  if (!stats.perItem[id]) stats.perItem[id] = { correct:0, trials:0 };
  stats.perItem[id].trials += 1;
  if (isCorrect) stats.perItem[id].correct += 1;
  saveStats(stats);
}

/** ========= ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ ========= **/
let deck = shuffle(questions).slice(0, QUESTIONS_PER_SESSION);
let step = 0;
let session = { correct: 0, trials: 0 };
let stats = loadStats();
let locked = false;

/** ========= DOM å–å¾— ========= **/
const progressPill = document.getElementById("progressPill");
const topicPill = document.getElementById("topicPill");
const qTitle = document.getElementById("qTitle");
const qImg = document.getElementById("qImg");
const choicesBox = document.getElementById("choices");
const explainBox = document.getElementById("explain");
const nextBtn = document.getElementById("nextBtn");
const skipBtn = document.getElementById("skipBtn");
const sessionAcc = document.getElementById("sessionAcc");
const sessionBar = document.getElementById("sessionBar");
const globalAcc = document.getElementById("globalAcc");
const globalBar = document.getElementById("globalBar");
const perItemTbody = document.querySelector("#perItem tbody");
const resetSession = document.getElementById("resetSession");
const resetGlobal = document.getElementById("resetGlobal");

/** ========= ç”»é¢æ›´æ–° ========= **/
function updateKPI() {
  const sAcc = session.trials ? session.correct / session.trials : NaN;
  const gAcc = stats.total.trials ? stats.total.correct / stats.total.trials : NaN;
  sessionAcc.textContent = pctTxt(sAcc);
  globalAcc.textContent  = pctTxt(gAcc);
  sessionBar.style.width = `${clamp((sAcc||0), 0, 1)*100}%`;
  globalBar.style.width  = `${clamp((gAcc||0), 0, 1)*100}%`;

  // å€‹åˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«
  perItemTbody.innerHTML = "";
  questions.forEach(q => {
    const r = stats.perItem[q.id] || {correct:0,trials:0};
    const row = document.createElement("tr");
    const acc = r.trials ? (r.correct / r.trials) : NaN;
    row.innerHTML = `
      <td>${q.id}</td>
      <td>${r.correct} / ${r.trials}</td>
      <td>${r.trials ? `<span class="mini-pill">${(acc*100).toFixed(0)}%</span>` : "â€”"}</td>
    `;
    perItemTbody.appendChild(row);
  });
}

function render() {
  updateKPI();
  const q = deck[step];
  if (!q) {
    qTitle.textContent = "âœ… çµ‚äº†ï¼ãŠã¤ã‹ã‚Œã•ã¾ã€‚";
    qImg.style.display = "none";
    choicesBox.innerHTML = "";
    explainBox.textContent = `ä»Šå›ã®æˆç¸¾ï¼š${session.correct} / ${session.trials}ï¼ˆ${pctTxt(session.correct/session.trials)}ï¼‰`;
    nextBtn.disabled = true;
    skipBtn.disabled = true;
    progressPill.textContent = `å®Œäº†`;
    topicPill.textContent = `å…¨ ${deck.length} å•`;
    return;
  }

  progressPill.textContent = `Q ${step+1} / ${deck.length}`;
  topicPill.textContent = q.id;

  qTitle.textContent = q.title;
  if (q.img) {
    qImg.src = q.img;
    qImg.style.display = "block";
  } else {
    qImg.style.display = "none";
  }

  // é¸æŠè‚¢ï¼ˆæ­£è§£ä½ç½®ãƒ©ãƒ³ãƒ€ãƒ ï¼‰
  const randomized = shuffle(q.choices);
  choicesBox.innerHTML = "";
  explainBox.textContent = "";
  nextBtn.disabled = true;
  locked = false;

  randomized.forEach(text => {
    const node = document.createElement("button");
    node.className = "choice";
    node.type = "button";
    node.textContent = text;
    node.addEventListener("click", () => onAnswer(q, text, node));
    choicesBox.appendChild(node);
  });
}

function onAnswer(q, selectedText, node) {
  if (locked) return;
  locked = true;

  const isCorrect = (selectedText === q.correct);
  session.trials += 1;
  if (isCorrect) session.correct += 1;
  bump(stats, q.id, isCorrect); // ç´¯ç©è¨˜éŒ²

  // è¦‹ãŸç›®
  const choiceNodes = [...document.querySelectorAll(".choice")];
  choiceNodes.forEach(n => {
    if (n.textContent === q.correct) n.classList.add("correct");
    if (n === node && !isCorrect) n.classList.add("wrong");
    n.disabled = true;
  });

  // è§£èª¬
  explainBox.innerHTML = (isCorrect ? "âœ… æ­£è§£ï¼" : `âŒ ä¸æ­£è§£ã€‚æ­£è§£ï¼šã€Œ${q.correct}ã€`) + "<br>" + q.explain;

  nextBtn.disabled = false;
  updateKPI();
}

nextBtn.addEventListener("click", () => {
  step += 1;
  render();
});

skipBtn.addEventListener("click", () => {
  // ã‚¹ã‚­ãƒƒãƒ—ã‚‚è©¦è¡Œã¨ã—ã¦ã‚«ã‚¦ãƒ³ãƒˆï¼ˆæ­£è§£ã§ã¯ãªã„ï¼‰
  const q = deck[step];
  session.trials += 1;
  bump(stats, q.id, false);
  step += 1;
  render();
});

resetSession.addEventListener("click", () => {
  session = { correct: 0, trials: 0 };
  updateKPI();
});

resetGlobal.addEventListener("click", () => {
  stats = { total: {correct:0, trials:0}, perItem: {} };
  saveStats(stats);
  updateKPI();
});

// åˆæœŸæç”»
render();

</script>
</body>
</html>
